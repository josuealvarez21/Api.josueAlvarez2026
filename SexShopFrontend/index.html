<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <!-- RENDER_DEPLOY_VERIFY_12345 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SexShop Deluxe - Tienda</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="container">
            <nav id="main-nav">
                <!-- Injected via JS -->
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="hero" style="padding: 40px 0; text-align: center;">
            <h1
                style="font-size: 3rem; margin-bottom: 10px; background: linear-gradient(to right, #fff, #ccc); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                Explora tus Fantasías</h1>
            <p style="color: #aaa; margin-bottom: 30px;">Productos exclusivos para momentos inolvidables.</p>
        </section>

        <section id="products" class="product-grid">
            <!-- Products injected here -->
            <div class="glass-panel" style="padding: 40px; grid-column: 1/-1; text-align: center;">
                Cargando productos...
            </div>
        </section>
    </main>

    <script type="module" src="app.js"></script>
    <script type="module">
        import './app.js'; // Ensure app.js runs
        import { addToCart, updateCartCount } from './cart.js';

        async function loadProducts() {
            try {
                // Using API_URL from app.js context or defining it
                const response = await fetch('https://api-josuealvarez20264345.onrender.com/api/products');
                if (!response.ok) throw new Error('Error fetching products');

                const products = await response.json();
                const container = document.getElementById('products');

                if (products.length === 0) {
                    container.innerHTML = '<div class="glass-panel" style="padding: 20px; text-align: center;">No hay productos disponibles.</div>';
                    return;
                }

                // Store products globally for addToCart access
                window.allProducts = products;

                container.innerHTML = products.map(product => `
                    <div class="product-card glass-panel">
                        <img src="${product.imageUrl || 'https://via.placeholder.com/300'}" alt="${product.name}" class="product-image">
                        <span class="badge">${product.category}</span>
                        <div class="product-info">
                            <h3 class="product-title">${product.name}</h3>
                            <p class="product-price">$${product.price.toFixed(2)}</p>
                            <button class="btn btn-primary" style="width: 100%; margin-top: auto;" onclick="addProductToCart(${product.id})">Añadir al Carrito</button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error(error);
                document.getElementById('products').innerHTML = '<div style="color: red; text-align: center;">Error cargando productos. Asegúrate de que la API esté corriendo en el puerto 5140.</div>';
            }
        }

        // Add to cart with product lookup
        window.addProductToCart = (productId) => {
            const product = window.allProducts.find(p => p.id === productId);
            if (product) {
                addToCart(product);

                // Visual feedback
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✓ Agregado';
                btn.style.background = '#4caf50';

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 1000);
            }
        };

        loadProducts();
    </script>
</body>

</html>